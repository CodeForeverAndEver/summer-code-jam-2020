{% extends 'main.html' %}

{% block content %}

<div class='w3-container w3-white' style='width: 1000px; height: 520px;'>

<h5>{{post.title}}</h5>
<p>
  Upvotes: {{post.upvotes}} | Downvotes: {{post.downvotes}}  
</p>
{% if user.is_authenticated and user == post.author %}
  <form method='POST' action='url'>
    {% csrf_token %}
    <input type="hidden" id="post_id" name="post_id" value="{{post.id}}" />
    <button type='submit'  name='delete' style='float:right;'>Delete</button>
  </form>
{% endif %}
<h6>submitted by <a style='color:blue;' href='/user/{{post.author}}'>{{post.author}}</a> on {{post.created}}</h6>
<textarea  style='resize: none; width: 100%; height: 200px;' disabled>{{post.body}}</textarea>
<button id='upvote_post'>UPVOTE</button>
<button id='downvote_post'>DOWNVOTE</button>

<form method='POST'>
  {% csrf_token %}
  <input type="hidden" name="post_id" value="{{post.id}}" />
  <textarea name="comment_body" style=' width: 700px; height: 100px;' placeholder='Comment'></textarea>
  <button type='submit' name='comment_post' >REPLY</button>
</form>

</div>


<div>
  {% for comment in comments %}
  <div style="padding-left:  {% widthratio comment.thread_level 1 50 %}px;">
    <div style="background-color: lightblue; width: 500px; height: 150px">
      <button name="{{comment.id}}" class='upvote_comment'>UPVOTE</button><button name="{{comment.id}}" class='downvote_comment'>DOWNVOTE</button>
      <p>
        <a style='color:blue;' href='/user/{{post.author}}'>{{comment.author}}</a> | Upvotes: {{comment.upvotes}} | Downvotes: {{comment.downvotes}} | {{comment.created}}
      </p>
      <p>
        {{comment.body}}
      </p>
    </div>
    <button onclick="fun({{comment.id}});">REPLY</button>
  </div>
  <form id="{{comment.id}}" style="display: None;" method="POST">
    {% csrf_token %}
    <input type="hidden" name="comment_id" value="{{comment.id}}"/>
    <input type="hidden" name="post_id" value="{{post.id}}"/>
    <textarea name="comment_body" style=' width: 700px; height: 100px;' placeholder='Comment'></textarea>
    <button type='submit' name='reply_to_comment' >REPLY</button>
  </form>
  {% endfor %} 
</div>

<script type="text/javascript">
  function fun(form_id) {
    console.log("FORM");
    var form = document.getElementById(form_id);
    console.log(form);
    form.style.display = "block";
  }

  $("#upvote_post").click(function(handler){
    let post_id = $("#post_id").val();
    // console.log(post_id);
    $.ajax({
      url: "/ajax/vote/post/"+post_id+"/1/",
      success: function(result){
        console.log("1");
      },
      error: function(result){
        console.log("2");
      }
    });
  });

  $("#downvote_post").click(function(handler){
    let post_id = $("#post_id").val();
    // console.log(post_id);
    $.ajax({
      url: "/ajax/vote/post/"+post_id+"/0/",
      success: function(result){
        console.log("1");
      },
      error: function(result){
        console.log("2");
      }
    });
  });

  $(".upvote_comment").click(function(handler){
    let comment_id = handler.currentTarget.name;
    console.log(comment_id);
    $.ajax({
      url: "/ajax/vote/comment/"+comment_id+"/1/",
      success: function(result){
        console.log("1");
      },
      error: function(result){
        console.log("2");
      }
    });
  });

  $(".downvote_comment").click(function(handler){
    let comment_id = handler.currentTarget.name;
    console.log(comment_id);
    $.ajax({
      url: "/ajax/vote/comment/"+comment_id+"/0/",
      success: function(result){
        console.log("1");
      },
      error: function(result){
        console.log("2");
      }
    });
  });


</script>

{% endblock %}
